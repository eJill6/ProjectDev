(function(){var n,r,i,t,f={}.hasOwnProperty,u=[].slice;n={LF:"\n",NULL:"\x00"};i=function(){function t(n,t,i){this.command=n;this.headers=t!=null?t:{};this.body=i!=null?i:""}var i;return t.prototype.toString=function(){var i,r,e,o,u;i=[this.command];e=this.headers["content-length"]===!1?!0:!1;e&&delete this.headers["content-length"];u=this.headers;for(r in u)f.call(u,r)&&(o=u[r],i.push(""+r+":"+o));return this.body&&!e&&i.push("content-length:"+t.sizeOfUTF8(this.body)),i.push(n.LF+this.body),i.join(n.LF)},t.sizeOfUTF8=function(n){return n?encodeURI(n).match(/%..|./g).length:0},i=function(i){var o,s,b,l,a,u,v,y,k,h,r,p,c,f,d,w,e;for(l=i.search(RegExp(""+n.LF+n.LF)),a=i.substring(0,l).split(n.LF),b=a.shift(),u={},p=function(n){return n.replace(/^\s+|\s+$/g,"")},w=a.reverse(),c=0,d=w.length;c<d;c++)h=w[c],y=h.indexOf(":"),u[p(h.substring(0,y))]=p(h.substring(y+1));if(o="",r=l+2,u["content-length"])k=parseInt(u["content-length"]),o=(""+i).substring(r,r+k);else for(s=null,v=f=r,e=i.length;r<=e?f<e:f>e;v=r<=e?++f:--f){if(s=i.charAt(v),s===n.NULL)break;o+=s}return new t(b,u,o)},t.unmarshall=function(t){var e,f,r,u;return f=t.split(RegExp(""+n.NULL+n.LF+"*")),u={frames:[],partial:""},u.frames=function(){var n,u,t,r;for(t=f.slice(0,-1),r=[],n=0,u=t.length;n<u;n++)e=t[n],r.push(i(e));return r}(),r=f.slice(-1)[0],r===n.LF||r.search(RegExp(""+n.NULL+n.LF+"*$"))!==-1?u.frames.push(i(r)):u.partial=r,u},t.marshall=function(i,r,u){var f;return f=new t(i,r,u),f.toString()+n.NULL},t}();r=function(){function r(n){this.ws=n;this.ws.binaryType="arraybuffer";this.counter=0;this.connected=!1;this.heartbeat={outgoing:1e4,incoming:1e4};this.maxWebSocketFrameSize=16384;this.subscriptions={};this.partialData=""}var f;return r.prototype.debug=function(n){var t;if(typeof window!="undefined"&&window!==null)return(t=window.console)!=null?t.log(n):void 0},f=function(){return Date.now?Date.now():(new Date).valueOf},r.prototype._transmit=function(n,t,r){var u;for(u=i.marshall(n,t,r),typeof this.debug=="function"&&this.debug(">>> "+u);;)if(u.length>this.maxWebSocketFrameSize)this.ws.send(u.substring(0,this.maxWebSocketFrameSize)),u=u.substring(this.maxWebSocketFrameSize),typeof this.debug=="function"&&this.debug("remaining = "+u.length);else return this.ws.send(u)},r.prototype._setupHeartbeat=function(i){var u,e,r,s,h,o;if((h=i.version)===t.VERSIONS.V1_1||h===t.VERSIONS.V1_2)return o=function(){var n,u,t,r;for(t=i["heart-beat"].split(","),r=[],n=0,u=t.length;n<u;n++)s=t[n],r.push(parseInt(s));return r}(),e=o[0],u=o[1],this.heartbeat.outgoing===0||u===0||(r=Math.max(this.heartbeat.outgoing,u),typeof this.debug=="function"&&this.debug("send PING every "+r+"ms"),this.pinger=t.setInterval(r,function(t){return function(){return t.ws.send(n.LF),typeof t.debug=="function"?t.debug(">>> PING"):void 0}}(this))),(this.heartbeat.incoming===0||e===0)?void 0:(r=Math.max(this.heartbeat.incoming,e),typeof this.debug=="function"&&this.debug("check PONG every "+r+"ms"),this.ponger=t.setInterval(r,function(n){return function(){var t;return t=f()-n.serverActivity,t>r*2?(typeof n.debug=="function"&&n.debug("did not receive server activity for the last "+t+"ms"),n.ws.close()):void 0}}(this)))},r.prototype._parseConnect=function(){var n,i,r,t;n=1<=arguments.length?u.call(arguments,0):[];t={};switch(n.length){case 2:t=n[0];i=n[1];break;case 3:n[1]instanceof Function?(t=n[0],i=n[1],r=n[2]):(t.login=n[0],t.passcode=n[1],i=n[2]);break;case 4:t.login=n[0];t.passcode=n[1];i=n[2];r=n[3];break;default:t.login=n[0];t.passcode=n[1];i=n[2];r=n[3];t.host=n[4]}return[t,i,r]},r.prototype.connect=function(){var s,r,e,o;return s=1<=arguments.length?u.call(arguments,0):[],o=this._parseConnect.apply(this,s),e=o[0],this.connectCallback=o[1],r=o[2],typeof this.debug=="function"&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(t){return function(u){var s,b,a,h,e,v,y,c,p,l,k,w,o;if(h=typeof ArrayBuffer!="undefined"&&u.data instanceof ArrayBuffer?(s=new Uint8Array(u.data),typeof t.debug=="function"?t.debug("--- got data length: "+s.length):void 0,function(){var n,i,t;for(t=[],n=0,i=s.length;n<i;n++)b=s[n],t.push(String.fromCharCode(b));return t}().join("")):u.data,t.serverActivity=f(),h===n.LF){typeof t.debug=="function"&&t.debug("<<< PONG");return}for(typeof t.debug=="function"&&t.debug("<<< "+h),p=i.unmarshall(t.partialData+h),t.partialData=p.partial,w=p.frames,o=[],l=0,k=w.length;l<k;l++){e=w[l];switch(e.command){case"CONNECTED":typeof t.debug=="function"&&t.debug("connected to server "+e.headers.server);t.connected=!0;t._setupHeartbeat(e.headers);o.push(typeof t.connectCallback=="function"?t.connectCallback(e):void 0);break;case"MESSAGE":c=e.headers.subscription;y=t.subscriptions[c]||t.onreceive;y?(a=t,v=e.headers["message-id"],e.ack=function(n){return n==null&&(n={}),a.ack(v,c,n)},e.nack=function(n){return n==null&&(n={}),a.nack(v,c,n)},o.push(y(e))):o.push(typeof t.debug=="function"?t.debug("Unhandled received MESSAGE: "+e):void 0);break;case"RECEIPT":o.push(typeof t.onreceipt=="function"?t.onreceipt(e):void 0);break;case"ERROR":o.push(typeof r=="function"?r(e):void 0);break;default:o.push(typeof t.debug=="function"?t.debug("Unhandled frame: "+e):void 0)}}return o}}(this),this.ws.onclose=function(n){return function(){var t;return t="Whoops! Lost connection to "+n.ws.url,typeof n.debug=="function"&&n.debug(t),n._cleanUp(),typeof r=="function"?r(t):void 0}}(this),this.ws.onopen=function(n){return function(){return typeof n.debug=="function"&&n.debug("Web Socket Opened..."),e["accept-version"]=t.VERSIONS.supportedVersions(),e["heart-beat"]=[n.heartbeat.outgoing,n.heartbeat.incoming].join(","),n._transmit("CONNECT",e)}}(this)},r.prototype.disconnect=function(n,t){return t==null&&(t={}),this._transmit("DISCONNECT",t),this.ws.onclose=null,this.ws.close(),this._cleanUp(),typeof n=="function"?n():void 0},r.prototype._cleanUp=function(){return this.connected=!1,this.pinger&&t.clearInterval(this.pinger),this.ponger?t.clearInterval(this.ponger):void 0},r.prototype.send=function(n,t,i){return t==null&&(t={}),i==null&&(i=""),t.destination=n,this._transmit("SEND",t,i)},r.prototype.subscribe=function(n,t,i){var r;return i==null&&(i={}),i.id||(i.id="sub-"+this.counter++),i.destination=n,this.subscriptions[i.id]=t,this._transmit("SUBSCRIBE",i),r=this,{id:i.id,unsubscribe:function(){return r.unsubscribe(i.id)}}},r.prototype.unsubscribe=function(n){return delete this.subscriptions[n],this._transmit("UNSUBSCRIBE",{id:n})},r.prototype.begin=function(n){var i,t;return t=n||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:t}),i=this,{id:t,commit:function(){return i.commit(t)},abort:function(){return i.abort(t)}}},r.prototype.commit=function(n){return this._transmit("COMMIT",{transaction:n})},r.prototype.abort=function(n){return this._transmit("ABORT",{transaction:n})},r.prototype.ack=function(n,t,i){return i==null&&(i={}),i["message-id"]=n,i.subscription=t,this._transmit("ACK",i)},r.prototype.nack=function(n,t,i){return i==null&&(i={}),i["message-id"]=n,i.subscription=t,this._transmit("NACK",i)},r}();t={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(n,i){var u,f;return i==null&&(i=["v10.stomp","v11.stomp"]),u=t.WebSocketClass||WebSocket,f=new u(n,i),new r(f)},over:function(n){return new r(n)},Frame:i};typeof exports!="undefined"&&exports!==null&&(exports.Stomp=t);typeof window!="undefined"&&window!==null?(t.setInterval=function(n,t){return window.setInterval(t,n)},t.clearInterval=function(n){return window.clearInterval(n)},window.Stomp=t):exports||(self.Stomp=t)}).call(this);